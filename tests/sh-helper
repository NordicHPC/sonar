# -*- mode: shell-script -*-

set -e -o pipefail
mkdir -p ${TMPDIR:-tmp}

function tmpfile() {
    local fn="${TMPDIR:-tmp}/$1.tmp"
    if [[ -z $SKIP ]]; then
        rm -f $fn
    fi
    echo $fn
}

function tmpdir() {
    local dn="${TMPDIR:-tmp}/$1.dir.tmp"
    if [[ -z $SKIP ]]; then
        rm -rf $dn
    fi
    echo $dn
}

function fail() {
    echo ' !!!ERROR!!!' "$1"
    exit 1
}

function assert_jq() {
    assert jq
}

function assert() {
    while [[ -n $1 ]]; do
        if [[ -z $(command -v $1) ]]; then
            fail "Install $1 first"
        fi
        shift 1
    done
}

function join() {
    local xs=$1
    shift 1
    while [[ -n $1 ]]; do
        xs="$xs,$1"
        shift 1
    done
    echo $xs
}

